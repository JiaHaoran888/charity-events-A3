<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Admin - Events Management</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="/css/style.css">
  <style>
    .admin-header{display:flex;justify-content:space-between;align-items:center;gap:12px}
    .control-bar{display:flex;gap:10px;align-items:center}
    .events-grid .card{padding:14px;border-radius:12px;display:flex;flex-direction:column;justify-content:space-between;min-height:140px}
    .edit-badge{background:linear-gradient(90deg,#7c5cff,#00d4ff);padding:6px 10px;border-radius:999px;color:#041021;font-weight:600}
    .panel-drawer{position:fixed;right:0;top:0;height:100vh;width:420px;background:linear-gradient(180deg,#041021,#071026);box-shadow:-30px 0 80px rgba(2,6,23,0.7);padding:22px;transform:translateX(110%);transition:transform .28s cubic-bezier(.2,.9,.2,1);z-index:120;border-left:1px solid rgba(255,255,255,0.03)}
    .panel-drawer.show{transform:translateX(0)}
    .drawer-head{display:flex;justify-content:space-between;align-items:center;gap:8px;margin-bottom:12px}
    .drawer-head h3{margin:0}
    .drawer-body{overflow:auto;padding-right:6px;height:calc(100vh - 140px)}
    .drawer-field{margin-bottom:12px}
    .drawer-field label{display:block;color:var(--muted);font-size:13px;margin-bottom:6px}
    .drawer-field input,.drawer-field textarea,.drawer-field select{width:100%;padding:10px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:#fff}
    .drawer-field textarea{min-height:80px}
    .reg-list .card{padding:10px;margin-bottom:8px}
    .drawer-actions{display:flex;justify-content:flex-end;gap:8px;margin-top:12px}
    .light-select{background:#ffffff;color:#0b1220;border:1px solid rgba(0,0,0,0.06);padding:8px;border-radius:8px}
    .control-bar .light-select{height:38px}
    @media (max-width:900px){ .panel-drawer{width:100%;} }
	input[type="datetime-local"]::-webkit-calendar-picker-indicator {
  -webkit-filter: invert(1) brightness(2); 
  filter: invert(1) brightness(2);
}

  </style>
</head>
<body ng-app="adminApp" ng-controller="AdminCtrl as vm">
  <header class="site-header">
    <div class="container header-inner">
      <div class="brand">
        <img src="/assets/placeholder.jpg" alt="logo" class="logo">
        <div>
          <h1>Admin - CityCare</h1>
        </div>
      </div>
      <nav class="main-nav">
        <a href="/admin/index.html">Dashboard</a>
        <a href="/">Site Home</a>
      </nav>
    </div>
  </header>

  <main class="container" style="padding-bottom:40px">
    <section class="card admin-header" style="margin-bottom:18px">
      <div>
        <h2 style="margin:0">Events Management</h2>
        <div class="muted" style="margin-top:6px">Create, edit, and manage charity events</div>
      </div>
      <div class="control-bar">
        <input type="text" placeholder="Search name or location" ng-model="searchText" ng-change="applyFilter()" style="padding:8px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:#fff">
        <select class="light-select" ng-model="filterStatus" ng-change="applyFilter()">
          <option value="">All statuses</option>
          <option value="active">active</option>
          <option value="paused">paused</option>
        </select>
        <button class="button" ng-click="reload()">Refresh</button>
        <button class="button" ng-click="openCreate()" title="Create new event">New Event</button>
      </div>
    </section>

    <section class="card events-grid" style="margin-bottom:18px">
      <div class="grid" style="grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:18px">
        <div class="card" ng-repeat="i in filteredEvents track by i.id">
          <div style="display:flex;gap:12px;align-items:flex-start">
            <img ng-src="{{i.image_url || '/assets/placeholder.jpg'}}" alt="" style="width:90px;height:70px;object-fit:cover;border-radius:8px">
            <div style="flex:1">
              <h4 style="margin:0">{{i.name}}</h4>
              <div class="muted" style="font-size:13px;margin-top:6px">{{i.location}} · {{i.event_date | date:'mediumDate'}}</div>
              <div style="margin-top:8px"><span class="badge">{{i.category}}</span> <span class="badge">{{i.status}}</span></div>
            </div>
          </div>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
            <div class="muted" style="font-size:13px">Raised ${{i.raised_amount | number:2}}</div>
            <div style="display:flex;gap:8px">
              <button class="button" ng-click="edit(i.id)">Edit</button>
              <button class="button muted" ng-click="confirmDelete(i.id)">Delete</button>
            </div>
          </div>
        </div>
      </div>
      <div class="no-results" ng-if="!filteredEvents || filteredEvents.length === 0" style="margin-top:12px">No events found.</div>
    </section>
  </main>

  <div class="panel-drawer" ng-class="{'show': drawerOpen}">
    <div class="drawer-head">
      <h3>{{ editId ? 'Edit Event' : 'Create New Event' }}</h3>
      <div style="display:flex;gap:8px;align-items:center">
        <span class="edit-badge" ng-if="editId">EDITING</span>
        <button class="button muted" ng-click="closeDrawer()">Close</button>
      </div>
    </div>
    <div class="drawer-body">
      <div class="drawer-field">
        <label>Event Name</label>
        <input type="text" ng-model="form.name">
      </div>
      <div class="drawer-field">
        <label>Short description</label>
        <input type="text" ng-model="form.short_description">
      </div>
      <div class="drawer-field">
        <label>Description</label>
        <textarea ng-model="form.description"></textarea>
      </div>
      <div class="drawer-field" style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
        <div>
          <label>Event date</label>
          <input type="datetime-local" ng-model="form.event_date">
        </div>
        <div>
          <label>Category ID</label>
          <input type="number" ng-model="form.category_id">
        </div>
      </div>
      <div class="drawer-field" style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
        <div>
          <label>Location</label>
          <input type="text" ng-model="form.location">
        </div>
        <div>
          <label>Address</label>
          <input type="text" ng-model="form.address">
        </div>
      </div>
      <div class="drawer-field" style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
        <div>
          <label>Price</label>
          <input type="number" step="0.01" ng-model="form.price">
        </div>
        <div>
          <label>Capacity</label>
          <input type="number" ng-model="form.capacity">
        </div>
      </div>
      <div class="drawer-field">
        <label>Image URL</label>
        <input type="text" ng-model="form.image_url">
      </div>
      <div class="drawer-field" style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
        <div>
          <label>Goal amount</label>
          <input type="number" step="0.01" ng-model="form.goal_amount">
        </div>
        <div>
          <label>Status</label>
          <select class="light-select" ng-model="form.status">
            <option value="active">active</option>
            <option value="paused">paused</option>
          </select>
        </div>
      </div>

      <div class="drawer-field" style="margin-top:6px">
        <label>Latitude / Longitude</label>
        <div style="display:flex;gap:8px">
          <input type="number" step="0.000001" placeholder="lat" ng-model="form.latitude" style="flex:1">
          <input type="number" step="0.000001" placeholder="lon" ng-model="form.longitude" style="flex:1">
        </div>
      </div>

      <div class="drawer-field" style="margin-top:12px">
        <label>Recent registrations</label>
        <div class="reg-list">
          <div class="card" ng-repeat="r in selectedRegs">
            <div style="display:flex;justify-content:space-between">
              <div><strong>{{r.name}}</strong> · {{r.contact_email}}</div>
              <div class="muted">{{ r.registration_date | date:'short' }}</div>
            </div>
            <div class="muted">{{r.number_of_tickets}} tickets · ${{r.amount_paid | number:2}}</div>
          </div>
          <div class="muted" ng-if="!selectedRegs || selectedRegs.length === 0">No registrations</div>
        </div>
      </div>

      <div class="drawer-actions">
        <button class="button" ng-click="save()">{{ editId ? 'Save Changes' : 'Create Event' }}</button>
        <button class="button muted" ng-click="reset()">Reset</button>
      </div>
    </div>
  </div>

  <div class="modal" ng-class="{'show': message || error}" role="dialog" aria-modal="true">
    <div class="modal-content">
      <button class="modal-close" ng-click="clearAlerts()">×</button>
      <div id="modal-body">
        <div ng-if="message">
          <h3>Success</h3>
          <p>{{message}}</p>
          <div style="display:flex;justify-content:flex-end;margin-top:12px">
            <button class="button" ng-click="clearAlerts()">OK</button>
          </div>
        </div>
        <div ng-if="error">
          <h3>Error</h3>
          <p>{{error}}</p>
          <div style="display:flex;justify-content:flex-end;margin-top:12px">
            <button class="button muted" ng-click="clearAlerts()">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container">
      <p>© 2025 CityCare Foundation - Admin</p>
    </div>
  </footer>

    <script src="/js/angular.min.js"></script>
  <script src="/admin/js/admin-app.js"></script>
</body>
</html>
